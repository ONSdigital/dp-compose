services:
  dp-cloud-flare-purge-stub:
    build:
      context: ../../stacks/dataset-catalogue/cloud-flare-purge-stub/
      dockerfile: Dockerfile
    ports:
      - 22500:22500
    environment:
      PORT: "22500"
      RATE_LIMIT_REQUESTS: 50
      RATE_LIMIT_PERIOD: 60
      CLOUD_FLARE_AUTH_TOKEN: "test-token"
    healthcheck:
      test: [ "CMD", "python", "-c", "import urllib.request as r; r.urlopen('http://localhost:22500/health')" ]
      interval: 10s
      timeout: 3s
      retries: 20
      start_period: 5s